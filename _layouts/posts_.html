<!-- 基础模板 -->
<!-- 这个网站的大部分页面的模板都是基于这个网页来的-->
<!-- 除了index页面，这个网页不应该作为网页的模板 -->

<!DOCTYPE html>
<html>

<head>
  <title>{{ page.title }}</title>
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/blockquote.css">
  <!-- 图标库 https://fontawesome.com/v4/icons/ 查看有哪些图标 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  {% include head.html %}
</head>

<body>
  <nav>
    <ul>
      <li><i class="fa fa-home" style="color: #999;" aria-hidden="true"></i><a href="/"></i>Home</a></li>
      <li><i class="fa fa-info-circle" style="color: #999;" aria-hidden="true"></i><a href="/about">About</a></li>
      <li><i class="fa fa-link" style="color: #999;" aria-hidden="true"></i><a href="/link">Link</a></li>
      <li><i class="fa fa-folder" style="color: #999;" aria-hidden="true"></i><a href="/blog">Blog</a></li>
      <!-- <li><i class="fa fa-adjust" style="color: #999;" aria-hidden="true"></i></li> -->
    </ul>
  </nav>
  <div class="container">
    <!-- 文章的模板 -->
    <!-- <h1>{{ page.title }}</h1> -->
    <!-- <p class="meta">{{ page.date | date_to_string }}</p> -->

    <!-- 添加目录容器 -->
    <div class="content-wrapper">
      <!-- 左侧目录 -->
      <div class="table-of-contents">
        <div class="toc-header">目录</div>
        <div class="toc-content" id="toc-content">
          <!-- 目录内容由JavaScript动态生成 -->
        </div>
      </div>

      <!-- 文章内容 -->
      <div class="post-content">
        <div class="post">
          {{ content }}
        </div>

        <!-- 添加上一篇和下一篇导航 -->
        <div class="post-navigation">
          <ul class="post-ul">
            <li>
              <div class="prev-post">
                {% if page.previous %}
                <span>上一篇：</span>
                <a href="{{ page.previous.url }}" title="{{ page.previous.title }}">{{ page.previous.title }}</a>
                {% else %}
                <span>上一篇：无</span>
                {% endif %}
              </div>
            </li>
            <li>
              <div class="next-post">
                {% if page.next %}
                <span>下一篇：</span>
                <a href="{{ page.next.url }}" title="{{ page.next.title }}">{{ page.next.title }}</a>
                {% else %}
                <span>下一篇：无</span>
                {% endif %}
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 内联样式 -->
    <style>
      div.post-navigation {
        /* 用于使ul列表撑满div的区域 */
        display: grid;
        font-size: 1.3em;
        margin-bottom: 10px;
        margin-top: 10px;
      }

      ul.post-ul {
        /* 取消列表开头的小圆点 */
        list-style: none;
        /* 横向列表 */
        display: flex;
        padding: 0%;
        margin: 0%;
        /* 两端对齐，制作左右分别对齐的效果 */
        justify-content: space-between;
      }

      /* 目录样式 */
      .content-wrapper {
        display: flex;
        gap: 20px;
        position: relative;
      }

      .table-of-contents {
        width: 250px;
        position: sticky;
        top: 20px;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        font-size: 14px;
        align-self: flex-start;
      }

      .toc-header {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 2px solid #007bff;
        color: #333;
      }

      .toc-content ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }

      .toc-content li {
        margin: 5px 0;
        line-height: 1.4;
      }

      .toc-content a {
        text-decoration: none;
        color: #555;
        display: block;
        padding: 3px 5px;
        border-radius: 3px;
        transition: all 0.2s ease;
      }

      .toc-content a:hover {
        color: #007bff;
        background-color: #e9ecef;
      }

      .toc-content .toc-h2 {
        padding-left: 10px;
      }

      .toc-content .toc-h3 {
        padding-left: 20px;
        font-size: 13px;
      }

      .toc-content .toc-h4 {
        padding-left: 30px;
        font-size: 12px;
      }

      .toc-content .active {
        color: #007bff;
        background-color: #e3f2fd;
        font-weight: bold;
      }

      .post-content {
        flex: 1;
        min-width: 0;
        /* 防止flex item溢出 */
      }

      /* 响应式设计：在小屏幕上隐藏目录 */
      @media (max-width: 768px) {
        .content-wrapper {
          flex-direction: column;
        }

        .table-of-contents {
          width: 100%;
          position: static;
          margin-bottom: 20px;
        }
      }
    </style>

    <!-- 目录生成脚本 -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // 获取文章内容区域
        const postContent = document.querySelector('.post');
        const headings = postContent.querySelectorAll('h1, h2, h3, h4');
        const tocContent = document.getElementById('toc-content');

        if (headings.length > 0) {
          const tocList = document.createElement('ul');
          let tocHTML = '';

          headings.forEach((heading, index) => {
            // 为每个标题添加ID（如果没有的话）
            if (!heading.id) {
              heading.id = 'heading-' + index;
            }

            // 确定层级类名
            let levelClass = '';
            switch (heading.tagName) {
              case 'H1':
                levelClass = 'toc-h1';
                break;
              case 'H2':
                levelClass = 'toc-h2';
                break;
              case 'H3':
                levelClass = 'toc-h3';
                break;
              case 'H4':
                levelClass = 'toc-h4';
                break;
            }

            tocHTML += `
        <li class="${levelClass}">
          <a href="#${heading.id}">${heading.textContent}</a>
        </li>
      `;
          });

          tocList.innerHTML = tocHTML;
          tocContent.appendChild(tocList);

          // 添加滚动监听高亮当前章节
          const tocLinks = tocContent.querySelectorAll('a');

          function highlightTOC() {
            let current = '';
            const scrollTop = window.pageYOffset;

            headings.forEach(heading => {
              const headingTop = heading.offsetTop;
              if (scrollTop >= headingTop - 100) {
                current = '#' + heading.id;
              }
            });

            tocLinks.forEach(link => {
              link.classList.remove('active');
              if (link.getAttribute('href') === current) {
                link.classList.add('active');
              }
            });
          }

          window.addEventListener('scroll', highlightTOC);
          highlightTOC(); // 初始高亮

        } else {
          // 如果没有标题，显示提示信息
          tocContent.innerHTML = '<p>本文暂无目录结构</p>';
        }
      });
    </script>
  </div><!-- /.container -->
  <footer>
    <ul>
      <li><a href="mailto:tai@foxmail.com">Email</a></li>
      <li><a href="https://github.com/dsghbc">GitHub</a></li>
    </ul>
  </footer>
</body>

</html>